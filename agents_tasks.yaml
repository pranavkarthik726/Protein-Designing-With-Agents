agents:
  - name: query_generator
    role: uniprot_query_generator
    goal: Generates a UniProt query from a given protein function. Ensure the query retrieves relevant proteins.
    backstory: Designed as a highly specialized bioinformatics assistant to construct precise UniProt queries.
    tools:
      - uniprot_tool
    verbose: true
    llm: gemini_llm

  - name: uniprot_query_assurance_agent
    role: query_assurance_agent
    goal: Ensures the generated UniProt query is accurate and relevant to the protein function. Verify that the query retrieves the correct proteins and aligns with the intended function.
    backstory: This agent acts as a quality control specialist for bioinformatics queries, ensuring that the query targets the right proteins.
    tools:
      - uniprot_tool
    verbose: true
    llm: gemini_llm

  - name: protein_expert_agent
    role: Protein Scaffolding Specialist
    goal: Assist in creating protein scaffolds by identifying which motifs should be masked or preserved based on UniProt features.
    backstory: Expert in computational protein design with experience in analyzing protein structural and functional data.
    tools:
      - get_protein__site_info
    verbose: true
    llm: gemini_llm

  - name: RF_Diffusion_Expert
    role: RF Diffusion Expert
    goal: Translate the protein scaffolding requirements into specific RF Diffusion implementation strategies, specifying which motifs to mask versus preserve and providing technical details.
    backstory: Expert in diffusion-based generative modeling for protein design.
    verbose: true
    llm: gemini_llm

tasks:
  - name: plan
    description: |
      1. Extract key biological terms from the protein function description.
      2. Map these terms to UniProt search fields and controlled vocabularies.
      3. Generate a structured UniProt query optimized for accuracy and recall.
      4. Validate and refine the query to ensure relevant search results.
    expected_output: UniProt query for the given protein function description
    agent: query_generator

  - name: query_review
    description: Review the UniProt query generated by the uniprot_query_generator agent.
    expected_input: A UniProt query string generated from a protein function description, along with the original user input.
    expected_output: |
      A validation report stating whether the query is accurate and retrieves relevant proteins.
      If the query is suboptimal, provide suggestions to improve it.
    steps:
      - Receive the generated UniProt query and the original protein function description.
      - Submit the query to the UniProt database using uniprot_tool.
      - Analyze the retrieved proteins and compare their functions to the intended protein function.
      - Identify mismatches or overly broad results.
      - Approve the query if highly accurate, otherwise provide improvement suggestions.
    acceptance_criteria:
      - The query retrieves proteins that strongly match the intended function.
      - The query does not produce irrelevant or overly broad results.
      - Suggestions for improvement are practical and enhance query precision.
      - The validation report clearly explains the decision.
    agent: uniprot_query_assurance_agent

  - name: protein_analysis_task
    description: |
      Analyze the provided UniProt features in JSON format, identifying all functional sites (active sites, binding sites, metal-binding sites, etc.).
      Interpret the user's desired protein function based on the session identifier.
      Determine which motifs should be preserved as anchors and which regions masked for redesign.
      Identify the most appropriate scaffolding approach and provide clear reasoning for your decisions, including motif positions.
    expected_output: |
      A detailed JSON report containing an analysis of UniProt features,
      the identified motifs to be preserved or masked with justification,
      and the recommended scaffolding approach.
    agent: protein_expert_agent

  - name: RF_Diffusion_configuration_task
    description: |
      Using the analysis from the previous task, generate a configuration script for running the RF Diffusion process.
      Include model settings, diffusion parameters, input file paths, output directory locations, and any optional parameters (such as contigmap).
    expected_output: A valid terminal script containing the RF Diffusion configuration with all necessary parameters.
    agent: RF_Diffusion_Expert
    context:
      - protein_analysis_task